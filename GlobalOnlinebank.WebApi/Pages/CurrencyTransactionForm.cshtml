@page
@model GlobalOnlinebank.WebApi.Pages.CurrencyTransferModel
@{
    ViewData["Title"] = "Валютный перевод";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<div class="container mt-4">
    <h2 class="mb-4">Валютный перевод</h2>

    <div id="progress" class="progress mb-4">
        <div id="progress-bar" class="progress-bar" style="width: 33%">Шаг 1 из 3</div>
    </div>

    <form id="transferForm">
        <div class="step step-1">
            <h4>Отправитель</h4>
            <div class="mb-3">
                <label class="form-label">Счёт отправителя</label>
                <input type="text" name="SenderAccountNumber" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Валюта</label>
                <input type="text" name="Currency" class="form-control" value="USD" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Сумма</label>
                <input type="number" step="0.01" name="Amount" class="form-control" required />
            </div>
            <button type="button" class="btn btn-primary next">Далее</button>
        </div>

        <div class="step step-2 d-none">
            <h4>Получатель</h4>
            <div class="mb-3">
                <label class="form-label">Имя получателя</label>
                <input type="text" name="RecipientName" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">SWIFT банка</label>
                <input type="text" name="RecipientBankSwift" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Наименование банка</label>
                <input type="text" name="RecipientBankName" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Страна</label>
                <input type="text" name="RecipientCountry" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Город</label>
                <input type="text" name="RecipientCity" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Адрес</label>
                <input type="text" name="RecipientAddress" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Назначение платежа</label>
                <textarea name="PaymentPurpose" class="form-control" rows="3" required></textarea>
            </div>
            <button type="button" class="btn btn-secondary prev">Назад</button>
            <button type="button" class="btn btn-primary next">Далее</button>
        </div>

        <div class="step step-3 d-none">
            <h4>Дополнительно</h4>
            <div class="mb-3">
                <label class="form-label">Счёт для списания комиссии</label>
                <input type="text" name="CommissionPayerAccountNumber" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Бонусный счёт (опционально)</label>
                <input type="text" name="BonusAccountNumber" class="form-control" />
            </div>

            <button type="button" class="btn btn-secondary prev">Назад</button>
            <button type="submit" class="btn btn-success">Отправить</button>
        </div>
    </form>

    <div id="result" class="mt-3"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const steps = document.querySelectorAll(".step");
        const progressBar = document.getElementById("progress-bar");
        let current = 0;

        const showStep = (index) => {
            steps.forEach((s, i) => s.classList.toggle("d-none", i !== index));
            progressBar.style.width = `${((index + 1) / steps.length) * 100}%`;
            progressBar.innerText = `Шаг ${index + 1} из ${steps.length}`;
        };

        document.querySelectorAll(".next").forEach(btn =>
            btn.addEventListener("click", () => {
                if (current < steps.length - 1) showStep(++current);
            })
        );

        document.querySelectorAll(".prev").forEach(btn =>
            btn.addEventListener("click", () => {
                if (current > 0) showStep(--current);
            })
        );

        document.getElementById("transferForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            console.log(JSON.stringify(data));

            /*const response = await fetch("/api/CurrencyTransfer", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });*/

            const resultDiv = document.getElementById("result");
            if (response.ok) {
                const res = await response.json();
                resultDiv.innerHTML = `<div class="alert alert-success">${res.message}</div>`;
            } else {
                const err = await response.text();
                resultDiv.innerHTML = `<div class="alert alert-danger">${err}</div>`;
            }
        });
    });

</script>